[[CISCN 2023 初赛]PwSh | NSSCTF](https://www.nssctf.cn/problem/4051)

看了下，全混淆了，用一个反混淆器

[denisugarte/PowerDrive: A tool for de-obfuscating PowerShell scripts (github.com)](https://github.com/denisugarte/PowerDrive)

提示可能包含恶意代码，用虚拟机拍快照、把网卡禁了

用管理员权限运行pwsh

```pwsh
Set-Executionpolicy Unrestricted
Import-Module ./PowerDrive.psm1
```

卡死了，换一个

[Malandrone/PowerDecode: PowerDecode is a PowerShell-based tool that allows to deobfuscate PowerShell scripts obfuscated across multiple layers. The tool performs code dynamic analysis, extracting malware hosting URLs and checking http response.It can also detect if the malware attempts to inject shellcode into memory. (github.com)](https://github.com/Malandrone/PowerDecode)

失败，再换

## 赛博厨子

看了一些文章，突然发现这玩意贼强

参考：
- [Deobfuscate PowerShell using subtract - CyberChef Recipe 0x4 - Securityinbits](https://www.securityinbits.com/tools/cyberchef/deobfuscate-powershell-using-subtract-cyberchef-recipe-0x4/)
- [Deobfuscate Script using CyberChef – Recipe 0x3 - Securityinbits](https://www.securityinbits.com/tools/deobfuscate-script-using-cyberchef-recipe-3/)

```
From_Base64('A-Za-z0-9+/=',true,false)
Raw_Inflate(0,0,'Adaptive',false,false)
```

上面这段代码可以解压

[From Base64, Raw Inflate - CyberChef](http://localhost:8080/#recipe=From_Base64('A-Za-z0-9%2B/%3D',true,false)Raw_Inflate(0,0,'Adaptive',false,false)&input=MVZoTmF4eEhFRDNYditpRFlYWkJXdXdFQXJISndRWVR5OGdTMkNLSGlDVUhJWC9rb0RpS3lNWFdmODlHOHM3VXg2dWU3aHBON3pxQlpLYTdxdnJWcTFmVnMrclN0My9vN2ovMC93TnRIKzVlYUx0Ny95U1drdG1tYlRodVRQMDZiZmUxcFkwZ3JOVWk5Zlk2dFBIT0JMWW5rZWMxN0Z1TG5wSEVZMlJ5VmdzcVM1VDBrTE0reWl5QTRDVFhTYTN5T29PNEVvV0xTK1U2bWp0eEYySzc1REtZVng1TGtnQld0cENqVUJZRStHZE12RnBvQ1hGc3dpU2hoZDNBQlhRUjltcUt4eGRqZTFSR2dQbXFxV1hUSUNDUjdmVEViZTFIVjdGSnYrMnlBVVlwWXEyUGpqVCsxUHZ3ekN4c1JncjV4MlhJRnF4eWVJWmZKNzBkanBrOWFCY0ZBcUxiR1pxVVhXZ0hTNHRyUDhTOUo2UERYa2I0clNrMnl3MXBOejlRVTRqV2VMK1FldG9mUmFhV1NadVJ0dGllTnZWbUpRNVZIUUo5NVJNQnNBWnJZTUZFZGRvakU2ZUhGcnFqRTNsUlNUd0tYMXV2U1NrUjl5RHVRQm9VdEJ6VEhnR0RUSTdacXJtOGdKd1FUZTdONEFqWUZlMndHdU5aVy9oeEMvS3ZCVytQQlVCaXRFdGU5UTBMODRzd0dRU3N0RVg2aWV6WlpONGhnbUpQa1YrTmx5UkNhYWoweXBrZFpsU0t6b0RMeXhlcmwvMVpCUGJYVGlvSElFV29IVnpRTlN0Szc3UkRYWW5Vbjc2TUV6TmtZWExHSmRaRGs0MVlXYk5jNm5JU2FNb2txWUVhWXd4TlJFWkJyeWxDYWlHTm92TVpkL0pndDdvRlN6Vk5raVlycHRrTWtxZ0IrZCt6ZE9xcTlxQkM4Nk1MQ3puZkJySklsbFhTUXp3MHpBOXl6OU5UYUx3djBhbzl5NS9CUnhvU0FPaVFKWXBSVjFpTUJRUXRNcHVjSmdIWDc2QW13V2FhUm5haDJaUTB0UytoN01xcWxDdUxCQ1dIQkVZZFZqbzVyMVBGZ0E2VFZaQWlOR2tyVEdvdHdBMXl5K09Na2xxUUp4UmtUdGRBNkNFS0hpcU9XSjVoOXBFMEdUek1xUUsrYWRUWm1tMnNtWU8wenRpQXVGNkJPVFU5dFoyejViQXpNaWg3VTZITTRXVklMbHNGK1ZUMUlSN3c0U0FyVHRJUnRnRnlVMjR1UE5UL1h5SmsyN096Z2RvSHlOYlNWeU8xWFdSQ3UwQ2h4YU1EVUE0eENONm1Md0NxL0N0UEVnM1ZYZGU1Snc2ZFdYRDV6YW9Rald1NCt6TzF3QitUL0JTU3p5QjdFUXpPblRhRGgzM3N0RHB0Yk42QmFaYXBWQnQ1WjI4bWhKaHltOXZWQUJQSVRvKzhiRk81L1J1WmhmcjhZYWRkZVp4cVpUSmg2UE4wcXBhZkw1MVFXUnA5b0xFOVVIWDNRbzAzU0g1SWtJRFJVbTFtWUtyNVBUc0VwK24wOTZ1SkNBbWVENnFQWkk5VVBYUmQ0QVpUMHdOcW5vWUFOSnlpZlp5KzRHRVNEMlRPdEhzNXcxcmpDWmhpemc0ZjNxWmlmQlJXT0oveXRBc3NBM1JXUlMwTEdnSWpENG5uRXZHc2FvY1l0Q3JUZ21PRWdUY1YrdVJZbGlUTVdXemlUM3BMVFZvRmNIZ05URHdIUldFTXdWbk5WNUcyYlB1YnlJQmd0SHRSS0ZXZUZzTUkzQ1RBMkR3Vnl6a0Z6OHk5a0hURmtaSjkyUURTd2t0TTB6bUpUeElMeE0xTmFLYjZuSlU2WkR4bXNkMzA2YVh5eFNzcXBrNGM5aEh3bFJFdDA2TE83QTA5Z2Z3ZEJ2QUNaTjNEbDRIdFJjL3B5RFdwSThEZ2cyYWtuNkovVDNGYzJ2MmtsYzZxdHd4Z21JRXplSnNtQXVkay80Snl0a0pyQk5pU0t3QzRNT1Y1T3NYUzB3R1MrQzJnY1lxR3ROYXBjckMzbTllQ01qdHAvY1pWY21kV1lHYU1ENVQ0eDJnbVpRZTZXR3JVcTdLMkhpckFxVU55VS9CSlZNeTJEeXpBL0lEYTNoZVZmaVJjME54QmxNNDVnWUFkRXFHL2lhTStlRkRDKytXVFZVUXBtSUt5UU5PbjBjaW9KSnh2QXpVN1B4TGJUWkQ5NnlLa240bVM5QVFlbFNhemxxR2NUVUFOSjhsNFFUUFNUeFArWm9OYVJMTWd0Skx0cVQxWGJGem5NdVBpT3JmNlU1andCR1BOamFMQkM2c0grWUxuOHZhNnE0N2p5UlBEK05mUGlwejE1TUhDSEVhdUxiK1dXQUREWVlNM2kxUHlZNkFvR1VxS2ozSUs2aHhxZEROa1NDelhJVWV0cStpZEVKN05oSzFtSHlMUmtTV0lnODFmUUI0Wkg2bWNmcisrU1l2T3Qremx0T1U5b0Q2QjBBcGttOHlDN1NVeXh0NmtVSXREeGVXbVZJSVpNWktaVXJTcTdhYWlEZHpaMlJHSFRjaHpUTXFFWXhsWGpydExmRmYvL2toT3FVWWs1QjBCWDRmSUpVbTRveFVFZGF3Z0JuaWNuak9XcWt3Q2lmdG1US1RjN0lxVW5RR0Q5UU5QY0VlWVIvQkliUHRGN0tVSzZmYWlDeDlKTlNud1VEWDFXM3Bvb3RYdWEzcC8rdmJsODR1UGg2Y3ZYbDllM0tRdjZkSEhrOS8vL2kzOWtoNzlrUTdmZlQ0K09rc2RVZmRWR243WkxIYlBOamFyZno0ZmY3cFpiTjZXMm1TemVmenk1TVBacThNbjZmYjIyV3FSRnVmdnpxNlBybjVkZDkzcSt2TE5YLzllTHM5L2ZIenc1SWVEbjM1ZUg3NCsvWFRWZGN1TjBjM2JvNnNQNjZkUC96dzlPbGwwWFRyWXVDYTFuTHJ1NEI3citlUFZhbkgvMkIrNFhDL1RjclU1N00wR1d1cVczMkFtaEhNVCt1TFY4K3YxK2RIVnpYcVQwdkkyTGUvK3ZmMFA&oeol=VT)

